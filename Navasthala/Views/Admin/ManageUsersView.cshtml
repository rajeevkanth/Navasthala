@using System.Web.Mvc.Html
@model Navasthala.ViewModel.UserViewModel

@{
    ViewBag.Title = "ManageUsersView";
    
}
<head>
    <title>Users panel</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js" type="text/javascript"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.2/jquery-ui.min.js" type="text/javascript"></script>
@*    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/themes/start/jquery-ui.css" rel="Stylesheet" type="text/css" />*@
    <link href="/Jqgrid/css/jquery-ui-1.10.3.custom.min.css" rel="stylesheet" type="text/css" />
    <link href="/Jqgrid/css/ui.jqgrid.css" rel="stylesheet" type="text/css" />
    <script src="/Jqgrid/Scripts/jquery.validate.min.js" type="text/javascript"></script>
    <script src="/Jqgrid/Scripts/grid.locale-en.js" type="text/javascript"></script>
    <script src="/Jqgrid/Scripts/jquery.jqGrid.min.js" type="text/javascript"></script>
    <script src="/Jqgrid/Scripts/jquery.maskedinput-1.2.2.min.js" type="text/javascript"></script>
</head>

<script type="text/javascript">
        $(document).ready(function ()
        {
            var updateDialog =
            {
                url: "@Url.Action("UpdateUser","Admin")"
                , closeAfterAdd: true
                , closeAfterEdit: true
                , afterShowForm: function (formId) {
                    //$("#PhoneNumber").mask("(999) 999-9999");
                    //$("#DateOfInvestment").datepicker();
                }
                , afterclickPgButtons: function (whichbutton, formid, rowid) {
                   // $("#PhoneNumber").mask("(999) 999-9999");
                }
                , modal: true
                
                , onclickSubmit: function (params) {
                    var ajaxData = {};

                    var list = $("#list");
                    var selectedRow = list.getGridParam("selrow");
                    rowData = list.getRowData(selectedRow);
                    ajaxData = { UserId: rowData.UserId };

                    return ajaxData;
                }
                
                , width: "400"
            };
            
            $.jgrid.nav.addtext = "Add";
            $.jgrid.nav.edittext = "Edit";
            $.jgrid.nav.deltext = "Delete";
            $.jgrid.edit.editCaption = "Edit User";
            $.jgrid.del.caption = "Delete User";
            $.jgrid.del.msg = "Delete selected User?";
            
            $("#list").jqGrid({
                url: "@Url.Action("GetUsers","Admin")",
                datatype: 'json',
                mtype: 'GET',
                colNames: ['UserName','LastName','FirstName','E-mail', 'DateOfBirth','Role','UserId'],
                colModel: [
                    { name: 'UserName', index: 'UserName', width: 100, align: 'left', editable: false,  formoptions: { elmsuffix: ' *'} },
                    { name: 'LastName', index: 'LastName', width: 100, align: 'left', editable: true, edittype: 'text', editrules: { required: true}, formoptions: { elmsuffix: ' *'} },
                    { name: 'FirstName', index: 'FirstName', width: 100, align: 'left', editable: true, edittype: 'text', editrules: { required: true}, formoptions: { elmsuffix: ' *'} },
                    { name: 'Email', index: 'Email', width: 100, align: 'left', formatter: 'mail', editable: true, edittype: 'text', editrules: { required: false, email: true }, formoptions: { elmsuffix: ' *'} },
                    { name: 'DateOfBirth', index: 'DateOfBirth', width: 75, align: 'left', formatter: 'date', datefmt: 'm/d/Y', editable: true, edittype: 'text', editrules: { required: true, date: true }, formoptions: { elmsuffix: ' *' } },
                    { name: 'Role', index: 'Role', width: 100, align: 'left', editable: true, edittype: 'text', editrules: { required: true}, formoptions: { elmsuffix: ' *'} },
                    { name: 'UserId', index: 'UserId', width: 40, align: 'left', /* key: true,*/ editable: false, editrules: { edithidden: false }, hidedlg: true, hidden: true }
                ],
                
                pager: $('#listPager'),
                //rowNum: 1000,
                //rowList: [1000],
                sortname: 'UserName',
                sortorder: "desc",
                viewrecords: true,
                imgpath: '/Content/Themes/Redmond/Images',
                caption: 'User List',
                autowidth: true,
                height:150,
            }).navGrid('#listPager',
                {
                    edit: true, del: true, search: false, refresh: true,add:true
                },
                updateDialog,
                updateDialog,
                updateDialog
            );
         

            $('#login').mousedown(function (e) {
                e.stopPropagation();
                window.location.href = "@Url.Action("Login","Account")";
            });

            $('#User').mousedown(function (e) {
                e.stopPropagation();
                window.location.href = "@Url.Action("CurrentUser","Home")";
            });

            $('#logoff').mousedown(function (e) {
                e.stopPropagation();
                window.location.href = "@Url.Action("LogOff","Account")";

            });

            $('#Home').mousedown(function (e) {
                e.stopPropagation();
                window.location.href = "@Url.Action("Index","Home")";
            });
        }
);
    </script>

<div class="page-region-content fg-color-white">
    <h3 class="fg-color-white icon-filter"> Filter Users</h3>
    <br>
        @using (Html.BeginForm())
        {
            <section id="search-form">
                <table>
                    <tr>
                        <td style="border: 0px;width: 200px;">
                            @Html.LabelFor(p=>p.Search.UserName)
                            @*                            <input type="text" value="@(ViewBag.UserName)" /> *@
                            @Html.TextBoxFor(p=>p.UserName)
                        </td>
                        <td style="border: 0px;width: 200px; float: left">
                            @Html.LabelFor(p=>p.Search.LastName)
                            @Html.TextBoxFor(p=>p.Search.LastName)
                        </td>
                        <td style="border: 0px;width: 200px; float: left">
                            @Html.LabelFor(p=>p.Search.FirstName)
                            @Html.TextBoxFor(p=>p.Search.FirstName)
                        </td>
                    </tr>
                    
                    <tr>
                        <td style="border: 0px;width: 200px;">
                            @Html.LabelFor(p=>p.Search.Email)
                            @Html.TextBoxFor(p=>p.Search.Email)
                        </td>
                        <td style="border: 0px;width: 200px;float: left ">
                            @Html.LabelFor(p=>p.Search.DateOfBirth)
                            @Html.TextBoxFor(p=>p.Search.DateOfBirth)
                        </td>

                        <td style="border: 0px;width: 200px; float: left">
                            @Html.LabelFor(p=>p.Search.RoleId)
                            @Html.DropDownList("RoleId",(SelectList)ViewBag.Roles)
                        </td>

                    </tr>
                    <tr>
                        <td style="border: 0px;">
                            <input type="button" value="Clear" id="submit-button"/>
                        </td>
                        <td style="border: 0px;">
                            <input type="submit" value="Search" id="search-button"/>
                        </td>
                    </tr>
                </table>

            </section>
             
        }
    
    <br>
    
    <table id="list" class="scroll"></table>
    <div id="listPager" class="scroll" style="text-align:center;"></div>                                                            
    <div id="listPsetcols" class="scroll" style="text-align:center;"></div>  
    

    
</div>